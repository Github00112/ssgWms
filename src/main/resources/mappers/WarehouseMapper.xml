<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssg.wsmt.inventory.mapper.WarehouseMapper">

    <insert id="createWarehouse" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO WAREHOUSE(TYPE, LOCATION, DELIVERY_CMP_ID)
        VALUES (#{TYPE}, #{LOCATION}, #{DELIVERY_CMP_ID})
    </insert>

    <insert id="saveWarehouseSection" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO WAREHOUSE_SECTION (WAREHOUSE_ID, NAME, TYPE)
        VALUES (#{WAREHOUSE_ID}, #{NAME}, #{TYPE})
    </insert>

<!--    <select id="readWarehouse" resultType="com.ssg.wsmt.inventory.domain.WarehouseVO">-->
<!--        SELECT-->
<!--            ID as id,-->
<!--            TYPE as type,-->
<!--            LOCATION as location,-->
<!--            DELIVERY_CMP_ID as deliveryId-->
<!--            FROM WAREHOUSE-->
<!--    </select>-->
    <select id="readWarehouse" resultType="com.ssg.wsmt.inventory.domain.WarehouseVO">
        SELECT
        ID as id,
        TYPE as type,
        LOCATION as location,
        DELIVERY_CMP_ID as deliveryId
        FROM WAREHOUSE
        <where>
            <if test="type != null and keyword != null">
                <choose>
                    <when test="type == 'type'">
                        TYPE LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'location'">
                        LOCATION LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <!-- 다른 검색 조건 추가 -->
                </choose>
            </if>
        </where>
        ORDER BY ID
        LIMIT #{page}, #{size}
    </select>
    <select id="readWarehouseSection" resultType="com.ssg.wsmt.inventory.dto.WarehouseDTO">
        SELECT
        WAREHOUSE.ID AS id,
        WAREHOUSE.TYPE AS type,
        WAREHOUSE.LOCATION AS location,
        WAREHOUSE.DELIVERY_CMP_ID AS deliveryId,
        GROUP_CONCAT(WAREHOUSE_SECTION.TYPE) AS SECTIONTYPE
        FROM
        WAREHOUSE
        JOIN
        WAREHOUSE_SECTION ON WAREHOUSE.ID = WAREHOUSE_SECTION.WAREHOUSE_ID
        <where>
            <if test="type != null and keyword != null">
                <choose>
                    <when test="type == 'type'">
                        AND WAREHOUSE.TYPE LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'location'">
                        AND WAREHOUSE.LOCATION LIKE CONCAT('%', #{keyword}, '%')
                    </when>
                    <when test="type == 'id'">
                        AND WAREHOUSE.ID = #{keyword}
                    </when>
                    <when test="type == 'sectiontype'">
                        AND WAREHOUSE_SECTION.TYPE LIKE CONCAT('%',#{keyword},'%')
                    </when>
                    <!-- 다른 검색 조건 추가 -->
                </choose>
            </if>
        </where>
        GROUP BY
        WAREHOUSE.ID,
        WAREHOUSE.TYPE,
        WAREHOUSE.LOCATION,
        WAREHOUSE.DELIVERY_CMP_ID
        ORDER BY WAREHOUSE.ID
        LIMIT #{page}, #{size}
    </select>



    <select id="getTotalCount" resultType="int">
        SELECT COUNT(*)
        FROM WAREHOUSE
        <where>
            <if test="type != null and keyword != null">
                <choose>
<!--                    <when test="type == 'type'">-->
<!--                        TYPE LIKE CONCAT('%', #{keyword}, '%')-->
<!--                    </when>-->
                    <when test="type == 'id'">
                        ID = #{keyword}
                    </when>
                    <!-- 다른 검색 조건 추가 -->
                </choose>
            </if>
        </where>
    </select>

    <update id="updateDeliveryCmpId">
        UPDATE WAREHOUSE SET DELIVERY_CMP_ID = #{delivery_id} WHERE ID = #{id}
    </update>

    <update id="updateWarehouse">
        UPDATE WAREHOUSE SET TYPE = #{type}, LOCATION = #{location}, DELIVERY_CMP_ID = #{delivery_id} WHERE ID = #{id}
    </update>

    <select id="findById" resultType="com.ssg.wsmt.inventory.domain.WarehouseVO">
        SELECT * FROM WAREHOUSE WHERE ID = #{id}
    </select>


</mapper>