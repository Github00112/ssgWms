<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssg.wsmt.inventory.mapper.InventoryMapper">

    <resultMap id="InventoryResultMap" type="com.ssg.wsmt.inventory.dto.InventoryDTO">
        <id property="id" column="ID"/>
        <result property="quantity" column="quantity"/>
        <result property="warehouseSectionId" column="wh_section_id"/>
        <result property="productId" column="product_id"/>
        <result property="warehouseId" column="id"/>
        <result property="location" column="location"/>
        <result property="productName" column="name"/>
        <result property="brandName" column="name"/>
        <result property="productPrice" column="price"/>
    </resultMap>

    <select id="findAllProducts" resultType="com.ssg.wsmt.product.dto.ProductDTO">
        SELECT * FROM PRODUCTS
    </select>

    <select id="findProductById" resultType="com.ssg.wsmt.product.dto.ProductDTO" parameterType="Long">
        SELECT * FROM PRODUCTS WHERE id = #{id}
    </select>
    <select id="selectAll" resultType="com.ssg.wsmt.inventory.domain.InventoryVO">
        SELECT * FROM INVENTORY
    </select>
<!--    <select id="findAll" resultMap="InventoryResultMap">-->
<!--        SELECT i.*, p.name as productName, p.price as productPrice-->
<!--        FROM INVENTORY i-->
<!--                 LEFT JOIN PRODUCTS p ON i.products_id = p.id-->
<!--    </select>-->


    <select id="findAll" resultType="com.ssg.wsmt.inventory.domain.InventoryVO">
        SELECT i.*, p.* FROM INVENTORY i
                                 LEFT JOIN PRODUCTS p ON i.products_id = p.id
    </select>

    <select id="findById" resultType="com.ssg.wsmt.inventory.domain.InventoryVO" parameterType="Long">
        SELECT i.*, p.* FROM INVENTORY i
                                 LEFT JOIN PRODUCTS p ON i.products_id = p.id
        WHERE i.id = #{id}
    </select>

    <select id="findByWarehouseId" resultType="com.ssg.wsmt.inventory.domain.InventoryVO" parameterType="Long">
        SELECT i.*, p.* FROM INVENTORY i
                                 LEFT JOIN PRODUCTS p ON i.products_id = p.id
                                 JOIN WAREHOUSE_SECTION ws ON i.wh_section_id = ws.id
                                 JOIN WAREHOUSE w ON ws.warehouse_id = w.id
        WHERE w.id = #{warehouseId}
    </select>

    <select id="search" resultType="com.ssg.wsmt.inventory.domain.InventoryVO" parameterType="String">
        SELECT i.*, p.* FROM INVENTORY i
                                 LEFT JOIN PRODUCTS p ON i.products_id = p.id
        WHERE i.id LIKE CONCAT('%', #{keyword}, '%')
           OR p.name LIKE CONCAT('%', #{keyword}, '%')
    </select>

</mapper>